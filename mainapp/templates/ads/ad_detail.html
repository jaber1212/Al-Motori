{% load static %}
{% load lang_value %}

<!DOCTYPE html>
<html lang="{{ lang|default:'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ meta.title|default:ad.title }}</title>
  {% if meta.description %}<meta name="description" content="{{ meta.description }}">{% endif %}
  {% if meta.image %}<meta property="og:image" content="{{ meta.image }}">{% endif %}
  <meta property="og:title" content="{{ meta.title|default:ad.title }}">
  <meta property="og:url" content="{{ meta.url }}">

  <style>
    :root {
      --bg:#f8fafc;
      --card:#fff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#2563eb;
      --brand-hover:#1e4db7;
      --radius:16px;
      --shadow:0 10px 25px rgba(0,0,0,.06);
    }

    html[lang="ar"] body { direction: rtl; }
    * { box-sizing:border-box; }
    body {
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Naskh Arabic", sans-serif;
      line-height:1.6;
    }
    a { color:var(--brand); text-decoration:none; }
    img { max-width:100%; height:auto; display:block; }

    .container {
      max-width:900px;
      margin:0 auto;
      padding:16px;
    }

    /* Header / breadcrumb */
    .topbar {
      display:flex; justify-content:space-between; align-items:center;
      flex-wrap:wrap; gap:8px; margin-bottom:16px;
    }
    .crumbs {
      font-size:13px; color:var(--muted);
    }
    .actions {
      display:flex; gap:8px;
    }
    .btn-icon {
      display:inline-flex; align-items:center; gap:6px;
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:8px;
      background:#fff;
      font-size:14px;
      color:var(--text);
    }

    /* Card container */
    .card {
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      padding:16px;
    }

    /* Viewer (main image/video) */
    .viewer {
      position:relative;
      background:#000;
      border-radius:12px;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:320px;
    }
    .viewer img, .viewer video {
      width:100%;
      height:auto;
      max-height:500px;
      object-fit:contain;
    }

    /* Thumbnails strip under main image */
    .media-strip {
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding:10px 0;
      margin-top:8px;
      scrollbar-width:thin;
    }
    .media-strip button {
      border:2px solid transparent;
      border-radius:10px;
      background:none;
      padding:0;
      cursor:pointer;
      flex:0 0 auto;
      transition:border-color .3s;
    }
    .media-strip button.active,
    .media-strip button:hover {
      border-color:var(--brand);
    }
    .media-strip img {
      width:80px;
      height:80px;
      border-radius:8px;
      object-fit:cover;
    }

    /* Title + meta */
    .title-wrap {
      margin-top:16px;
    }
    .title-wrap h1 {
      font-size:24px;
      margin:0 0 4px;
      line-height:1.3;
    }
    .meta {
      font-size:13px;
      color:var(--muted);
    }

    /* Description */
    .section {
      margin-top:20px;
    }
    .section h3 {
      margin:0 0 8px;
      font-size:16px;
      font-weight:600;
    }
    .desc {
      font-size:15px;
      color:var(--text);
      white-space:pre-wrap;
    }
.publish-hint {
  margin-top: 20px;
  padding: 16px;
  border: 1px dashed var(--line);
  border-radius: 14px;
  background: #f9fafb;
  text-align: center;
}

.hint-text {
  font-size: 15px;
  color: var(--text);
  margin: 0 0 10px;
}

.hint-btn {
  background: var(--brand);
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
}

.hint-btn:hover {
  background: var(--brand-hover);
}
.whatsapp-btn {
  background: #25D366 !important; /* WhatsApp green */
  color: #fff !important;
}

.whatsapp-btn:hover {
  background: #1ebe5d !important;
}

.whatsapp-btn .wa-icon {
  font-size: 18px;
}

    /* Specs grid */
    .specs {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:10px;
    }
    .spec {
      background:#f9fafb;
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 12px;
    }
    .spec .label {
      font-size:12px;
      color:var(--muted);
      margin:0 0 4px;
    }
    .spec .value {
      font-size:15px;
      font-weight:600;
      color:var(--text);
      margin:0;
    }

    /* CTA button */
    .cta {
      margin-top:24px;
      display:flex;
      justify-content:center;
    }
    .btn {
      display:inline-flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      background:var(--brand);
      color:#fff;
      border:none;
      border-radius:12px;
      padding:14px 20px;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      width:100%;
      max-width:360px;
      transition:background .3s;
    }
    .btn:hover { background:var(--brand-hover); }

    /* Seller info */
    .seller {
      margin-top:20px;
      font-size:14px;
      color:var(--muted);
      border-top:1px dashed var(--line);
      padding-top:12px;
    }

    /* Responsive tweaks */
    @media (max-width:640px) {
      .title-wrap h1 { font-size:20px; }
      .btn { font-size:15px; padding:12px 16px; }
      .media-strip img { width:64px; height:64px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Topbar -->
    <div class="topbar">
<div class="actions">
  {% if lang == "ar" %}
    <a class="btn-icon" href="?lang=en">ğŸ‡¬ğŸ‡§ English</a>
  {% else %}
    <a class="btn-icon" href="?lang=ar">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</a>
  {% endif %}
</div>
      <div class="actions">
        <a class="btn-icon" href="javascript:window.print()">ğŸ–¨ï¸ {% if lang == 'ar' %}Ø·Ø¨Ø§Ø¹Ø©{% else %}Print{% endif %}</a>
        <a class="btn-icon" href="{{ meta.url }}">ğŸ”— {% if lang == 'ar' %}Ù…Ø´Ø§Ø±ÙƒØ©{% else %}Share{% endif %}</a>
      </div>
    </div>

    <!-- Ad Card -->
    <section class="card">
      <!-- Media viewer -->
      <div class="viewer" id="viewer">
        {% if images and images.0 %}
          <img id="viewerImg" src="{{ images.0 }}" alt="main image">
        {% elif video %}
          <video id="viewerVideo" src="{{ video }}" controls playsinline></video>
        {% else %}
          <img id="viewerImg" src="{% static 'img/placeholder.png' %}" alt="placeholder">
        {% endif %}
      </div>

      <!-- Thumbnails -->
      {% if images %}
      <div class="media-strip" id="thumbs">
        {% for u in images %}
          <button type="button" data-media="img" data-src="{{ u }}">
            <img src="{{ u }}" alt="thumb {{ forloop.counter }}">
          </button>
        {% endfor %}
        {% if video %}
      <button type="button" data-media="video" data-src="{{ video }}">
  <div style="position:relative;">
    <img src="{{ images.0|default:'{% static "img/p.jpeg" %}' }}" alt="video thumbnail">
    <span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
                 font-size:38px;color:white;text-shadow:0 0 8px rgba(0,0,0,0.7);">â–¶ï¸</span>
  </div>
</button>

        {% endif %}
      </div>
      {% endif %}

      <!-- Title and details -->
      <div class="title-wrap">
        <h1>{{ ad.title|default:category.name }}</h1>
        <div class="meta">
          {{ category.name }}
          {% if ad.city %} â€¢ {{ ad.city }}{% endif %}
          {% if ad.published_at %} â€¢ {{ ad.published_at|date:"Y-m-d H:i" }}{% endif %}
          â€¢ {{ ad.code }}
        </div>
      </div>

      <!-- Description -->
<!--      {% if ad.description %}-->
<!--      <div class="section">-->
<!--        <h3>{% if lang == 'ar' %}Ø§Ù„ÙˆØµÙ{% else %}Description{% endif %}</h3>-->
<!--        <div class="desc">{{ ad.description|linebreaksbr }}</div>-->
<!--      </div>-->
<!--      {% endif %}-->

      <!-- Specs -->
      <div class="section">
        <h3>{% if lang == 'ar' %}Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©{% else %}Core Info{% endif %}</h3>
        <div class="specs">
          {% for f in core %}
            {% if f.value %}
              <div class="spec">

                <p class="label">{{ f.label }}</p>
                <p class="value">{{ f.value }}</p>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
{% if dynamic %}
  <div class="section">
    <h3>{% if lang == 'ar' %}ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©{% else %}More Details{% endif %}</h3>

    <div class="specs">
      {% for f in dynamic %}
        {% if f.value %}
          <div class="spec">
            <p class="label">{{ f.label }}</p>

            <p class="value">
       {{ f.value }}
            </p>


          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}
<!-- Publish App Hint -->

      <!-- Call Seller Button -->
        {% if phone %}
        <div class="cta">
          <a href="tel:{{ phone }}" class="btn">
            {% if lang == 'ar' %}Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨Ø§Ø¦Ø¹{% else %}Call Seller{% endif %}
          </a>
        </div>
        {% endif %}
{% if phone %}
<div class="cta">
  <a href="https://wa.me/{{ phone|cut:'+' }}" target="_blank" class="btn whatsapp-btn">
    <span class="wa-icon"></span>
    {% if lang == 'ar' %}
      Ù…Ø±Ø§Ø³Ù„Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    {% else %}
      Chat on WhatsApp
    {% endif %}
  </a>
</div>
{% endif %}


<div class="publish-hint">
  <p class="hint-text">
    {% if lang == 'ar' %}
      Ù‡Ù„ ØªØ±ØºØ¨ Ø¨Ù†Ø´Ø± Ø§Ø¹Ù„Ø§Ù† Ù…Ø±ÙƒØ¨ØªÙƒ ØŸ
    {% else %}
      Do you want to publish your car Ads?
    {% endif %}
  </p>

  <button class="hint-btn" onclick="openStore()">
    {% if lang == 'ar' %}
      Ù†Ø¹Ù…ØŒ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…ØªØ¬Ø±
    {% else %}
      Yes, go to the store
    {% endif %}
  </button>
</div>

      <!-- Seller Info -->
      <div class="seller">
        <!--<div><strong>{% if lang == 'ar' %}Ø§Ù„Ø¨Ø§Ø¦Ø¹{% else %}Seller{% endif %}:</strong> {{ ad.seller_name|default:"â€”" }}</div>-->
        <!--<div>-->
<!--            <strong>{% if lang == 'ar' %}Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©{% else %}City{% endif %}:</strong> {{ ad.city|default:"â€”" }}</div>-->
        <div><strong>{% if lang == 'ar' %}Ø±Ù…Ø² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†{% else %}Ad Code{% endif %}:</strong> {{ ad.code }}</div>
      </div>
    </section>
  </div>

  <!-- JS for gallery preview -->
  <script>
    (function(){
      const thumbs = document.getElementById('thumbs');
      const viewer = document.getElementById('viewer');
      if (!thumbs || !viewer) return;

      function showImage(src, btn){
        viewer.innerHTML = '';
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'image';
        img.style.opacity = 0;
        viewer.appendChild(img);
        requestAnimationFrame(()=> img.style.transition = 'opacity .3s', img.style.opacity = 1);
        thumbs.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      }

      function showVideo(src, btn){
        viewer.innerHTML = '';
        const v = document.createElement('video');
        v.src = src;
        v.controls = true;
        v.playsInline = true;
        v.style.opacity = 0;
        viewer.appendChild(v);
        requestAnimationFrame(()=> v.style.transition = 'opacity .3s', v.style.opacity = 1);
        thumbs.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      }

      thumbs.addEventListener('click', e=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const kind = btn.dataset.media;
        const src = btn.dataset.src;
        if(kind === 'video') showVideo(src, btn);
        else showImage(src, btn);
      });
    })();

  </script>
<script>
  function openStore() {
    const ua = navigator.userAgent || navigator.vendor || window.opera;

    // iOS
    if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
      window.location.href = "https://apps.apple.com/jo/app/motoria/id6754542282";
      return;
    }

    // Android
    if (/android/i.test(ua)) {
      window.location.href = "https://play.google.com/store/apps/details?id=com.mj.motoria";
      return;
    }

    // Fallback (desktop or unknown)
    window.location.href = "https://apps.apple.com/jo/app/motoria/id6754542282";
  }
</script>

</body>
</html>
